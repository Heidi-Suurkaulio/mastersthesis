\section{Method}
\label{method}

(TODO the history of network analysis)
%TODO computer aided network analysis <- distinction between 'verkostotutkimus' mentioned in Juuso Marttila's thesis. 
My method is computer aided (social) network analysis. It is one of the most implemented methods in the field of digital humanities. Generally network analysis has other more everyday applications, such as, the analysis of the internet as a network in the field of technology. Quite a few textbooks have been written on network analysis.

%Furthermore, in the field of technology network analysis does have some everyday application, such as the analysis of the internet. 

\subsection{Defining the Network}
\label{network}
Network analysis combines mathematics, statistics and social scineces. Primarily it is based on the mathematical graph theory. A graph is a representation of the network. Graph includes nodes (also colled vertice) and edges (also called links and connections).

\begin{figure}[h]
	\includegraphics[scale=0.25]{example_network.drawio.png}
	\centering
	\caption{A sample from the graph} 
	\centering
\end{figure}
In this context the graph's nodes depict individual councillors with the input of name and id number. Correspondingly the edges represent the kinships between two nodes. For instance, in Figure 1 we can see that Johan Bengtsson (Schroderus) Skytte (id 184) is Bengt Johansson Skytte's (id 183) father and a maternal grandfather for Johan Göransson Gyllenstierna (id 90) and Göran Göransson Gyllenstierna (id 87). Johan Göransson and Göran Göransson are brothers, however, their father is not mentioned in the dataset. Göran Göransson also has further links in the network. \footfullcite{councillorsDS}

Calculating different statistics is a crucial part of the network analysis. One of the most important measures is the \textbf{node degree}. In all its simplicity node degree means the amount of edges connected to a specific node. For example, the degree of Johan Bengtsson (Schroderus) Skytte (id 184) is three or the degree of Bengt Johansson Skytte (id 183) is one. The \textbf{average degree} is the mean [keskiarvo] of all the node degrees of the specific graph. 

The \textbf{density} of the network is based on the node degrees. In a dense network almost every node is connected to each other, but a sparse graph has just a few edges in it. The scale of density is from 0 to 1, 1 meaning a graph with every node connected to every other node. In pratice density is probably not the most depicting parameter of social networks. It is heavily dependant on the size of the network. 

The amount of all possible edges increase rapidly with the number of nodes. Formally, the number of possible edges follows the binomial coefficient. The formula being:\footcite[p. 16.]{laininen2002}
\begin{equation*}
\binom{n}{k} = \frac{n!}{k!(n-k)!} = \frac{n(n-1)...(n-k+1)}{k!}
\end{equation*}
In this case $k = 2$, because two nodes share one edge. The variable n is the amount of nodes in the graph. In R environment this can be calculated easily using the function \texttt{choose(n,k)}. For example in a graph consisting of 257 nodes (the amount of the councillors in the dataset) the amount of possible edges is 32 896:
\begin{equation*}
\binom{257}{2} = \frac{257!}{2!(257-2)!}
\end{equation*}
or \texttt{choose(257,2)}. That is why I choose the programming!

In practice the rapidly growing amount of possible edges makes it inefficient to compare two graphs of different size. The number of possible edges in a graph with 100 nodes is 4 950 and in a graph with 101 nodes it is 5 050 a difference of 100 possible edges. In the context of social networks the difference is signifficant.

Another important factor is whether the graph is \textbf{directed} or \textbf{undirected}. In directed graph the edges have directions, like in the communication networks a message has a sender and a receiver. The directions are marked with an arrow. In undirected graphs the edges are bidirectional (two way), for example, a relationship between two brothers can be understood as undirected. Directed graphs have more features and a more complex structures, for instance, the degrees of inbound and outbound edges can be counted separately. For sipmlicity, the graphs presented in this work are undirected.

\subsection{Implementation of the Network Analysis}
I use the combination of Python programming language and Gephi software in the data processing and analysis. Python is used for extracting the data from the councillors-dataset and formulating it in the right format: readable for Gephi. Whereas the actual network analysis: visualization and calculating statistics, is performed with Gephi. 

Python is a high level\footnote{Meaning code intended to be read and undersood by humans if compared for example with binary code written only with 0s and 1s.} programming language. Python can be used in variety of tasks including data processing, machine learning (AI models) or web development. Python is intended to be of object oriented programming style, however, it is not determined to be used only on that paradigm.\footcite[p. 1.]{pythonbook} For instance, my personal programming style is more in the imperative style. 

I selected Python due its simple syntax and ease in implementing relatively small tasks in data processing. The language is understandable and widely used amongst scientists, which makes the work replicable. To be precise the scripts are written with Python 3, exact version being Python 3.11.7.

As graphs are structures commonly used in programming, it would have been possible to conduct the actual network analysis using tools provided by Python, yet, Gephi software provides a graphical user interface (GUI) and more intuitive tools for the manipulation of the graph. Furthermore, the Gephi format makes the data and graph accessible also for non programmers.

Gephi is a software for network visualization and analysis. It contains tools for manipulating, filtering, clustering and visualizing the graph. It has built in appliances for fixing errors in data and calculating necessary statistics.\footcite{gephi} Gephi reads data from text format (comma separated values .csv) or Microsoft Excel tables (XLSX), and Gephi projects are saved as .gephi files. The processed graphs and data can be exported as images or tables.  

Nonetheless, Gephi does have some weaknesses. It is not always the most intuitive to use, and especially the visual configurations of the graph causes some issues. I have encountered difficulties with the node labels (the councilor's name next to the node). Sometimes the problems lies in the Gephi settings, but if the whole software crashes when trying to make the node labels visible, the problem lies within the software itself and should be solved when starting the program.\footnote{For Linux environments opening Gephi from command line with command "LIBGL\_ALWAYS\_SOFTWARE=1 ./gephi" can sometimes help.} 

Lastly, I use R TODO

All of these tools are open source and free to download. In the name of replicability and transparency, all scripts written for this work available on my GitHub page.\footnote{\url{https://github.com/Heidi-Suurkaulio/mastersthesis}}

Basically the steps of network analysis are : \begin{enumerate}
	\item Choosing the subject and data
	\item Pre processing the data for the network analysis
	\item Constructing the graph and finding possible issues and errors 
	\item Counting the statistics
	\item Deciding the layout (algorithm)
	\item Doing the interpretations
\end{enumerate}
However, the analysis is not that straightforward, sometimes the steps 2 and 3 must be repeated and re-repeated. Yet, on some circumstances the graph is not visualized or the statistics are not deemed important. These steps will be discussed in practice below.

\subsubsection{Test Run}
%TODO fix councillor / councillor typo

To draft the structure of the graph and understand the nuances of the given data, a test run was carried out. The test run was done with a simple Python script, and no attention was paid to the temporal aspects of the network or the potential directions within the graph. The script and Gephi project used, and the visualization of the graph of the test run is available in GitHub in the TestRun folder\footnote{\url{https://github.com/Heidi-Suurkaulio/mastersthesis/tree/main/TestRun}}

The data processing was started by manually cleaning the data in LibreOffice Calc (equivalent to Microsoft Excel). The columns and rows containing information of the source material of the dataset and councillor's years active were removed. That made the structure of the data coherent and easier to manipulate with the Python script. The manually cleaned data is exported as .csv (comma separated values) file. The .csv file's header (the first line of the file) should be modified so that the column name "No." is changed to "Id" and "Family members in the council of the realm" is changed to "Family", the first one can cause an error if referenced in the Python code, the latter is inconveniently long.

The script itself reads the data from the .csv file. The connections between the councillors are separated from the "Family" column, based on the knowledge that each connection is marked with the id number of another councillor. The connections are then formatted and printed to .csv file. The connections .csv file containing values for "Source" id of the source concillor, "Target" id of target councillor, "Type" standard "Undirected", "Id" id number for the connection, "Weight" standard 1.0. Another .csv file is formatted and printed with the information of councillors' names and id numbers.

\begin{table}[h]
	\caption{Example of the connections .csv file}
	\centering
	\begin{tabular}{cccccc}
		\hline
		1 &Source, &Target, &Type, &Id, &Weight \\
		\hline
		2 &231, &228, &Undirected, &0, &1.0 \\
		\hline
		3 &231, &230, &Undirected, &1, &1.0 \\
		\hline
	\end{tabular}
\end{table}
\begin{table}[h]
	\caption{Example of the councillors .csv file}
	\centering
	\begin{tabular}{ccc}	
		\hline
		1 &Id; &Label \\
		\hline
		2 &162; &Ingemar Petri \\
		\hline
		3 &231; &Tre Rosor, Ture Jönsson \\
		\hline
	\end{tabular}
\end{table}

These .csv files are readable for Gephi. The outcome was an undirected graph of the councillors' affiliation network that had accumulated during the 160 years. The graph consisted of 261 nodes (257 real + 4 "ghosts") and 372 edges (including self loops and "ghost" nodes). The test run revealed three problems within the graph: the emergence of the empty "ghost" nodes, parallel edges and thirdly self loops. 

The "ghost" nodes were excess nodes with no name and only an id number and one or two connections in the graph. They were due to the references to the data points removed from the original dataset, and therefore can be ignored. The ghosts are discussed further in the subsection \ref{sources}. However, the more essential problem were parallel edges and self loops.

The parallel edges occur because one relationship, such as father and son, is sometimes marked parallel in the dataset. For example, in the case of Göran Göransson Gyllenstierna (id 87) the relatives are "Maternal Grandfather 184, Brother 90, Father-in-law 3, ...", and the same relationship is found in his grandfather's Johan Bengtsson (Schroderus) Skytte's (id 184) links: "Son 183, Grandson through daughter 87". Yet, the connection to Göran Göransson's brother Johan Göransson Gyllenstierna (id 90) is not marked in the grandfathers links. This means that the node of Göran Göransson Gyllenstierna (id 87) has one excess link compared to his brother's node. The case is visualized in the Figure 2.

\begin{figure}[h]
	\includegraphics[scale=0.20]{double_link.drawio.png}
	\centering
	\caption{Visualisation of the parallel edge and self loop} 
	\centering
\end{figure}

These duplicate edges would cause bias to the calculation of the node degrees and any statistics based on them. A node degree is a sum of all the edges connected to one node, and if the relationships are inconsistently marked with one or two edges, the factually similar nodes would get different degrees. These inconsistent node degrees would accumulate when counting the average degrees an so forth. The problem of parallel edges is widely recognized in the field of network analysis, and therefore Gephi does have some builtin features for handling it.

While importing data to Gephi (on Import Spreadsheet) the strategy for merging the parallel edges can be chosen. One option is, for example, placing the sum or average of the parallel edges in the edge's degree, yet using only one connection to to represent the edge in the graph. In this context a more simple solution was chosen, with the option "Firs" Gephi will use only the first connection between two nodes ignoring any latter ones. This will reduce the amount of connections from 698 found in the connections.csv to only 372.

Self loops occur when one node has – for some reason or another – a connection to itself. Similarly to the parallel edges, they cause bias to the node degrees. In this graph a self loop can be found at least on the node with id 5 and id 90. In the case of id 5: Gustaf Axelsson Baner, his relatives are "Father 4, Father-in-law 217, Brother 9, Sons 5, 7, 8, 10, Sons-in-law 152 and 197", and similarly with id 90: Johan Göransson Gyllenstierna his family reads "Maternal Grandfather 184, Brother 90". These self loops are most likely caused by a typo in the dataset, because it is reasonable to assume that none is a son or brother to themselves.
 
Gephi does have a switch whether or not self loops are allowed in the graph, and it can automatically remove them based on the preference. The self loops are present in the test run graph alongside with the ghost nodes, yet those will be removed from the subsequent analysis. To highlight the ghosts they are colored cray, and the four nodes referred as an example here are colored red in the test run graph.

The last step in the preparation of the network analysis is the selection of the layout algorithm. For the test run an algorithm called Yifan Hu was used with default configurations except parameter theta set to 2.0. Then layout option "noOverlap" was chosen to separate possibly overlapping nodes, and some further manual placement of the nodes was done to make the graph more readable. The outcome was visually somewhat dense network in the middle and mostly unconnected isolated nodes around it. 

\subsection{Fitting Modern Model on a Historical Time Period}
\begin{quote}
	Every model is an approximation.\\
	All models are wrong; some models are useful.\footcite[prefix]{statisticsfor}
\end{quote}

A graph is elementally a generalizing and simplifying model of complex social networks within the Swedish Council of the Realm. Yet, when bulding any kinds of (computational) models, decisions between the complexity and abstraction must be made. In fact besides too simplifying models, too complex or overfitted ones are a problem on their own.\footnote{TODO} Due that, one of the most important question is what factors to include and and what to exclude. Yet, a more existential question is what we can even know about historical social networks. 

As I am working with pre-collected data, many of the significant choices have been made by the authors of the dataset, Hakanen and Koskinen, and by the scholars their work is leaning on. Thus, it is important to understand the limitations of the data and model. The data–and consequently the graph–is able to give an abstraction of the offically recorded family links inside the Council of the Realm. However, with the data in question, it is not possible to know about the messy every day relationships, friendships, informal discussions, intentions, emotions or disputes these 257 men have had. 

The general historical data also has its limitations. What comes to the study of early modern period, the scholars are working with a finite body of source material. As mentioned in the section \ref{sources} the national order of keeping records of the population was given in 1686. And, source material concerning lower social classes like peasants, women or marginalized groups are even harder to find.\footnote{TODO} Still, at least noble women are included in the contemporary lineage diagrams as seen later in Figure \ref{queenlineage}, which in itself means that women had meaning and status in the social realm. So maybe building a network including noblewomen or the noblemen and their clients would be an achievable task in the future.

As discussed in the beginning of this section (\ref{method}) networks were not explicitly part of the early modern social or political theory. However, did the contemporaries understand their social relations–families and friendships–as networks is a more complex question. And it probably cannot ever be answered undisputedly. Still, when applying a modern model to historical context, it is important to remember that we are operating on modern time with modern understanding, and be aware of the possible anachronims.

Early modern Sweden was a hierarchical and inegual society. The social order was divided into four estates: the Nobles, the Clergy, the Burghers and the Peasants, which all had their own privileges and duties. Most of the privileges belonged to the Nobles while the Peasants had parctically none. Even though the ideal of the society was static–everything and everyone had its owen place–social mobility amongst the estates did happen.\footcites[p. 21-23,]{hopesAndFearsIntro}[p. 21-22.]{agencyAndStateBuilding} 

The social structure was justified by the Lutheran theology and religion. According to Lutheran doctrine, God had chosen the monarch to hold the divine power and justise on Earth, as God did in the Kingdom of Heaven. The disrespect of the monarch became a taboo, and an unexpiated sin would doom the whole community to face the God's wrath. Still a consensus and harmony were seen as ideals in the political sphere.\footcites[p. 24-28,]{hopesAndFearsIntro}[p. 161-163.]{pSuurvalta}

\begin{figure}
	\includegraphics[width=\linewidth]{QueenChristinaLineage.png}
	\caption[Lineage of the house of Vasa from the \textit{Hortus Regius}]{Lineage of the house of Vasa from the \textit{Hortus Regius} or "Queen Christina's Genealogical Tree with Political Emblems".(\cite{hortusregius})} 
	\centering
	\label{queenlineage}
\end{figure}

For instance, a widely known manuscript from early modern period \textit{Hortus Regius} ("the Royal Guarden") can be used to illustrate the worldview of the early modern nobility. Hortus Regius is digitized and freely available on the internet making it easy to approach.\footnote{In 2025: Internet Archive: \url{https://archive.org/details/urn-nbn-se-kb-digark-4937173/mode/1up} Library of Congress: \url{https://www.loc.gov/resource/gdcwdl.wdl\_17187/?st=gallery}.} The book was given to queen Christina by a diplomat Shering Rosenhane (1609-1663) in circa 1645. It consists of delicately illustrated political emblems\footnote{Instructions, virtues, metaphors} and noble family trees leading to queen Christina.\footcites{congresslibrary}[p. 271.]{BlennowAnna} The manuscript has been widely used by scholars of early modern North.

In his monography \textit{Pohjoinen suurvalta} Petri Karonen interprets the drawing of a building and scale found in Hortus Regius as a metaphor to the structure of the kingdom. The building consists of four floors on top of each other. Each floor represents each estate. Next to the building is a scale with a crown on one side and the symbols of the four estates on the other. When the crown and the symbols are present, the scale is in equilibrium. The hierarcical structure of the building with the scale were symbols of the ideal static, harmonious and immutable world order.\footcite[p. 162-165.]{pSuurvalta}

When it comes to the subject of this work, the more relevant parts of the manuscrip are the family trees. In Hortus Regius there are nine genealogy charts depicting royal families in Europe at the time. The charts are drawn as trees with filigree leaves, and beautiful backgrounds and animals such as lions, horses and deer beside them. The ornaments probably holding meaningful symbolism.\footcite{hortusregius} Figure \ref{queenlineage} is a portrayal of the patrilineal tree of queen Christina and also the Vasa dynasty.

Gustavus Vasa "Gustavus I Rex" is found on the trunk of the tree. His children–including the female descendants–and their families are depicted as the branches. Gustavus Vasa's son and Christina's grandfather king Charles IX "Carolus IX Rex" and Christina's father Gustavus Adolphus "Gustavus Adolphus Rex" can be found near the treetop. Christina herself "Christina Regina" is on the top of the tree with a crown. 

Interestingly, some political picks are easy to spot on the genealogy chart of Vasa dynasty. The branch of Gustavus Vasa's son king Eric XIV (1533-1577) "Ericus 14 Rex(TODO check)" is broken violently leaving behind just a sharp cutting. In fact Eric was dethroned by his brother duke John (1537-1592, future king John III) and later poisoned.\footcite[p. 118-124.]{MelinEtAl} Yet, no mention of Eric's two children with his wife of ignoble birth Karin Månsdotter can be found either. These political choises are understandable when thinkig the family tree in its context. 

As a matter of fact, genealogy charts were of a high value to the aristocracy on the early modern timeperiod. Family trees were to prove the noble birth and therefore to legitimate the high status and rank (the position signed by God). The charts have been so valuable that in some cases they have been enhanced or even forged.\footnote{TODO}

One compelling question is wheither or not family trees can be understood as networks.\footnote{I have had unoffical discussions with my friends an colleques about the subject matter and most of them have counted family trees as networks.} Technically they do fit the criteria of a network with nodes (persons) and directed edges (inheritance). Furthermore, some text books have depicted family trees as an examples of simple networks.\footnote{See e.g. TODO} Obviously, family trees still have not been used in the sense of network analysis or as analytical tools as we know them today. But the contemporaries may have still been more familiar with the idea of networks than we may think.

\subsection{the Script}
For the conclusive analysis, I did some improvements to the Python cript. The script is available in GitHub\footnote{\url{https://github.com/Heidi-Suurkaulio/mastersthesis/tree/main/PythonScript}} and can be found in Appendix \ref{script}. The viable version of the script is largely based on the test run script, however I added the functionality and did some refactoring; adjustments to make the code more slick. 

The scirpt reads and prints data in exaclty same format as the previous one. The input data must be formatted similarily to the example of Table \ref{tab1} in the .csv format. However, the name of the input file is given as a command line parameter. The new functionality is that also the timerange of the network can be delimited with command line parameters. As a side-effect of the timerange functionality, the "ghost" nodes discussed in Chapter \ref{sources} are removed automatically.

The format of the command is as follows: 
\begin{verbatim}
python data_sifter.py Councillors_of_the_Realm1523-1680.csv
\end{verbatim}

This produces the network from the original timeperiod given in the dataset. And, for example, command "\texttt{python data\_sifter.py <dataset.csv> prior 1650}" and "\texttt{python data\_sifter.py <dataset.csv> post 1590}" limits the networks to councillors and their relatives appointed before 1650 or after 1590. Lastly the command "\texttt{python data\_sifter.py <dataset.csv> 1540 1620}" delimits the network to councillors and their relatives appointed between 1540 and 1620.

When it comes to the script and the graph, I made some simplifications. The types of the relationships, such as brother, grandfather or , are not taken into account. Each relationship is taken from the dataset by the Id number and marked as an undirected edge with weight standard 1.0. This means that the graph does not separate blood relations from the relationships formed through marriages. As family ties per se have been mentioned to be important in the previous research, this graph depicts family ties as an abstraction.\footnote{TODO} 

The second simplification is that only the years of appointments are taken into account, but the years of death are not. Most of the time the position of the councillor was a lifelong.\footcite[TODO]{HakanenAKoskinen2017} So, the graph can not give a defined picture of the amount of the councillors active during a certain timeperiod. Basically the graph represents the family network of councillors appointed during certain timeperiod, and answers the question: \textit{Who were appointed to the Council and to which degree they were related to each other?} The script could be further develop into regognizing the type of the relationship and taking the years of death–the obvious end to the position–into account.

\subsubsection{Testing the Script}
Before anything else the script had to be tested. Testing is one of the most important–yet daunting–task in programming. Due the size and complexity of the Councillors dataset, the Python script is hard and ambiguous to test with the original data. To test the logic and behavior of the script I crated a small test dataset with simple dummy data. The test dataset is intentionally so small that it is readable by human. With the script the test dataset is available in GitHub.\footnote{\url{https://github.com/Heidi-Suurkaulio/mastersthesis/tree/main/PythonScript}} 

The test dataset consist of 12 entries with values for name, Id number, (year of) appointment and family links. The names are represented by capital alphabets from A to L, and Ids are sequential numbers from 1 to 12. The values in appointment-column are numbers between 1000 and 1299, and there are intentionally four entries within every range of 100. The family links are represented by numbers found in the Ids except one which should be excluded by the script if everything works as planned. 

\begin{table}
	\caption{Example of the test dataset}
	\centering
	\begin{tabular}{cccc}	
		\hline
		Name; &Id; &Appointed; &Family\\
		\hline
		A; &1; &1000; &example 11\\
		\hline
		B; &2; &1000; &3, 4\\
		\hline
	\end{tabular}
\end{table}

When run with default setting the test dataset should produce 13 connections excluding the connection to the non-existent Id 30, as it does. Giving the range 1000-1999, 1100-1199 and 1200-1299 as arguments divides the dataset in the groups of four as intended. Lastly giving the "prior 1150" and "post 1138" as arguments reduces the amount of entries and connections as expected. With the small test dataset the algorithm should work as intended. Inconveniently, the accuracy of the connections still has to be checked manually. 

To review the results the script gives with the original dataset I used some simple R script to do dublicate checking.